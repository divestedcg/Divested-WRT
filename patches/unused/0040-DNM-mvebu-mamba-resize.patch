From 77d833d9c574f16d89252a6811d8c0b1cc149825 Mon Sep 17 00:00:00 2001
From: Tad <tad@spotco.us>
Date: Fri, 5 Feb 2021 14:39:57 -0500
Subject: [PATCH] DNM: mvebu: mamba: resize kernel to 6MB

---
 target/linux/mvebu/image/cortexa9.mk          |  2 +-
 .../999-DNM-dts-mamba-resize.patch            | 47 +++++++++++++++++++
 2 files changed, 48 insertions(+), 1 deletion(-)
 create mode 100644 target/linux/mvebu/patches-5.4/999-DNM-dts-mamba-resize.patch

diff --git a/target/linux/mvebu/image/cortexa9.mk b/target/linux/mvebu/image/cortexa9.mk
index 968e2a38f4..2c2086188b 100644
--- a/target/linux/mvebu/image/cortexa9.mk
+++ b/target/linux/mvebu/image/cortexa9.mk
@@ -118,7 +118,7 @@ define Device/linksys_wrt1900ac-v1
   DEVICE_ALT0_MODEL := Mamba
   DEVICE_DTS := armada-xp-linksys-mamba
   DEVICE_PACKAGES += mwlwifi-firmware-88w8864
-  KERNEL_SIZE := 3072k
+  KERNEL_SIZE := 6144k
   SUPPORTED_DEVICES += armada-xp-linksys-mamba linksys,mamba
   DEFAULT := n
 endef
diff --git a/target/linux/mvebu/patches-5.4/999-DNM-dts-mamba-resize.patch b/target/linux/mvebu/patches-5.4/999-DNM-dts-mamba-resize.patch
new file mode 100644
index 0000000000..d0f4f118b3
--- /dev/null
+++ b/target/linux/mvebu/patches-5.4/999-DNM-dts-mamba-resize.patch
@@ -0,0 +1,47 @@
+From bf96612b124ad8960fc08b2ad46b2096dece185f Mon Sep 17 00:00:00 2001
+From: Tad <tad@spotco.us>
+Date: Fri, 5 Feb 2021 14:29:28 -0500
+Subject: [PATCH] DNM: ARM: dts: armada-xp-linksys-mamba: Increase kernel
+ partition to 6MB
+
+---
+ arch/arm/boot/dts/armada-xp-linksys-mamba.dts | 12 ++++++------
+ 1 file changed, 6 insertions(+), 6 deletions(-)
+
+diff --git a/arch/arm/boot/dts/armada-xp-linksys-mamba.dts b/arch/arm/boot/dts/armada-xp-linksys-mamba.dts
+index 8480a1691..271941992 100644
+--- a/arch/arm/boot/dts/armada-xp-linksys-mamba.dts
++++ b/arch/arm/boot/dts/armada-xp-linksys-mamba.dts
+@@ -357,23 +357,23 @@
+ 			/* kernel1 overlaps with rootfs1 by design */
+ 			partition@a00000 {
+ 				label = "kernel1";
+-				reg = <0xa00000 0x2800000>;  /* 40MB */
++				reg = <0xa00000 0x2800000>;  /* 40MiB */
+ 			};
+ 
+-			partition@d00000 {
++			partition@1000000 {
+ 				label = "rootfs1";
+-				reg = <0xd00000 0x2500000>;  /* 37MB */
++				reg = <0x1000000 0x2200000>;  /* 34MiB */
+ 			};
+ 
+ 			/* kernel2 overlaps with rootfs2 by design */
+ 			partition@3200000 {
+ 				label = "kernel2";
+-				reg = <0x3200000 0x2800000>; /* 40MB */
++				reg = <0x3200000 0x2800000>; /* 40MiB */
+ 			};
+ 
+-			partition@3500000 {
++			partition@3800000 {
+ 				label = "rootfs2";
+-				reg = <0x3500000 0x2500000>; /* 37MB */
++				reg = <0x3800000 0x2200000>; /* 34MiB */
+ 			};
+ 
+ 			/*
+-- 
+2.29.2
+
-- 
2.29.2

