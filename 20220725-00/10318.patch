From febd0d9433723ae9e9b34cac7a79a44144c8f0e6 Mon Sep 17 00:00:00 2001
From: John Audia <therealgraysky@proton.me>
Date: Thu, 21 Jul 2022 16:19:32 -0400
Subject: [PATCH 1/3] kernel: bump 5.10 to 5.10.132

All patches automatically rebased.

Signed-off-by: John Audia <therealgraysky@proton.me>
---
 include/kernel-5.10                                         | 4 ++--
 .../0003-leds-add-reset-controller-based-driver.patch       | 6 +++---
 ...18-watchdog-allow-building-BCM7038_WDT-for-BCM4908.patch | 4 ++--
 ...tchdog-bcm7038_wdt-Support-BCM6345-compatible-stri.patch | 2 +-
 ...1-of-net-pass-the-dst-buffer-to-of_get_mac_address.patch | 2 +-
 ...from-spurious-interrupts-due-to-tegra2-silicon-bug.patch | 2 +-
 6 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/include/kernel-5.10 b/include/kernel-5.10
index f517e3b6a7cd..4b6aaa008721 100644
--- a/include/kernel-5.10
+++ b/include/kernel-5.10
@@ -1,2 +1,2 @@
-LINUX_VERSION-5.10 = .131
-LINUX_KERNEL_HASH-5.10.131 = 8bc441442c16c330a7148fe3cca9edcd98bc0fc9f68304633c7eb641770d21ce
+LINUX_VERSION-5.10 = .132
+LINUX_KERNEL_HASH-5.10.132 = 7d05a931eee01dea64fc73849e275ff14664ff98813f95f40588f04fdf1cfa2a
diff --git a/target/linux/ath79/patches-5.10/0003-leds-add-reset-controller-based-driver.patch b/target/linux/ath79/patches-5.10/0003-leds-add-reset-controller-based-driver.patch
index 68b831036576..4a721f2af26a 100644
--- a/target/linux/ath79/patches-5.10/0003-leds-add-reset-controller-based-driver.patch
+++ b/target/linux/ath79/patches-5.10/0003-leds-add-reset-controller-based-driver.patch
@@ -13,9 +13,9 @@ Signed-off-by: John Crispin <john@phrozen.org>
 
 --- a/drivers/leds/Kconfig
 +++ b/drivers/leds/Kconfig
-@@ -929,6 +929,17 @@ config LEDS_ACER_A500
- 	  This option enables support for the Power Button LED of
- 	  Acer Iconia Tab A500.
+@@ -931,6 +931,17 @@ config LEDS_ACER_A500
+ 
+ source "drivers/leds/blink/Kconfig"
  
 +config LEDS_RESET
 +	tristate "LED support for reset-controller API"
diff --git a/target/linux/bcm4908/patches-5.10/089-v5.18-watchdog-allow-building-BCM7038_WDT-for-BCM4908.patch b/target/linux/bcm4908/patches-5.10/089-v5.18-watchdog-allow-building-BCM7038_WDT-for-BCM4908.patch
index a03d538db925..ea75181a6edb 100644
--- a/target/linux/bcm4908/patches-5.10/089-v5.18-watchdog-allow-building-BCM7038_WDT-for-BCM4908.patch
+++ b/target/linux/bcm4908/patches-5.10/089-v5.18-watchdog-allow-building-BCM7038_WDT-for-BCM4908.patch
@@ -21,8 +21,8 @@ Signed-off-by: Wim Van Sebroeck <wim@linux-watchdog.org>
 
 --- a/drivers/watchdog/Kconfig
 +++ b/drivers/watchdog/Kconfig
-@@ -1779,7 +1779,7 @@ config BCM7038_WDT
- 	tristate "BCM63xx/BCM7038 Watchdog"
+@@ -1800,7 +1800,7 @@ config BCM7038_WDT
+ 	tristate "BCM7038 Watchdog"
  	select WATCHDOG_CORE
  	depends on HAS_IOMEM
 -	depends on ARCH_BRCMSTB || BMIPS_GENERIC || COMPILE_TEST
diff --git a/target/linux/bcm4908/patches-5.10/090-v5.20-watchdog-bcm7038_wdt-Support-BCM6345-compatible-stri.patch b/target/linux/bcm4908/patches-5.10/090-v5.20-watchdog-bcm7038_wdt-Support-BCM6345-compatible-stri.patch
index 9d11a55ffa9d..d6d2fd9ab612 100644
--- a/target/linux/bcm4908/patches-5.10/090-v5.20-watchdog-bcm7038_wdt-Support-BCM6345-compatible-stri.patch
+++ b/target/linux/bcm4908/patches-5.10/090-v5.20-watchdog-bcm7038_wdt-Support-BCM6345-compatible-stri.patch
@@ -24,7 +24,7 @@ Signed-off-by: Wim Van Sebroeck <wim@linux-watchdog.org>
 
 --- a/drivers/watchdog/bcm7038_wdt.c
 +++ b/drivers/watchdog/bcm7038_wdt.c
-@@ -218,6 +218,7 @@ static SIMPLE_DEV_PM_OPS(bcm7038_wdt_pm_ops, bcm7038_wdt_suspend,
+@@ -193,6 +193,7 @@ static SIMPLE_DEV_PM_OPS(bcm7038_wdt_pm_
  			 bcm7038_wdt_resume);
  
  static const struct of_device_id bcm7038_wdt_match[] = {
diff --git a/target/linux/generic/backport-5.10/732-net-next-1-of-net-pass-the-dst-buffer-to-of_get_mac_address.patch b/target/linux/generic/backport-5.10/732-net-next-1-of-net-pass-the-dst-buffer-to-of_get_mac_address.patch
index 80f51e7a2237..c7a2fa9b11bf 100644
--- a/target/linux/generic/backport-5.10/732-net-next-1-of-net-pass-the-dst-buffer-to-of_get_mac_address.patch
+++ b/target/linux/generic/backport-5.10/732-net-next-1-of-net-pass-the-dst-buffer-to-of_get_mac_address.patch
@@ -1162,7 +1162,7 @@ Signed-off-by: David S. Miller <davem@davemloft.net>
  
 --- a/drivers/net/ethernet/stmicro/stmmac/dwmac-dwc-qos-eth.c
 +++ b/drivers/net/ethernet/stmicro/stmmac/dwmac-dwc-qos-eth.c
-@@ -444,7 +444,7 @@ static int dwc_eth_dwmac_probe(struct pl
+@@ -445,7 +445,7 @@ static int dwc_eth_dwmac_probe(struct pl
  	if (IS_ERR(stmmac_res.addr))
  		return PTR_ERR(stmmac_res.addr);
  
diff --git a/target/linux/tegra/patches-5.10/100-serial8250-on-tegra-hsuart-recover-from-spurious-interrupts-due-to-tegra2-silicon-bug.patch b/target/linux/tegra/patches-5.10/100-serial8250-on-tegra-hsuart-recover-from-spurious-interrupts-due-to-tegra2-silicon-bug.patch
index 08ed9d441c5f..8f01f73eb24a 100644
--- a/target/linux/tegra/patches-5.10/100-serial8250-on-tegra-hsuart-recover-from-spurious-interrupts-due-to-tegra2-silicon-bug.patch
+++ b/target/linux/tegra/patches-5.10/100-serial8250-on-tegra-hsuart-recover-from-spurious-interrupts-due-to-tegra2-silicon-bug.patch
@@ -36,7 +36,7 @@ David
 
 --- a/drivers/tty/serial/8250/8250_core.c
 +++ b/drivers/tty/serial/8250/8250_core.c
-@@ -133,6 +133,38 @@ static irqreturn_t serial8250_interrupt(
+@@ -134,6 +134,38 @@ static irqreturn_t serial8250_interrupt(
  
  		if (l == i->head && pass_counter++ > PASS_LIMIT)
  			break;

From 6138d0698a7f689cc0de50482f2890ce6f0e9496 Mon Sep 17 00:00:00 2001
From: John Audia <therealgraysky@proton.me>
Date: Mon, 25 Jul 2022 09:21:12 -0400
Subject: [PATCH 2/3] kernel: bump 5.10 to 5.10.133

All patches automatically rebased.

Build system: x86_64
Build-tested: ipq806x/R7800

Signed-off-by: John Audia <therealgraysky@proton.me>
---
 include/kernel-5.10                                           | 4 ++--
 target/linux/generic/hack-5.10/221-module_exports.patch       | 2 +-
 .../generic/pending-5.10/203-kallsyms_uncompressed.patch      | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/include/kernel-5.10 b/include/kernel-5.10
index 4b6aaa008721..bce261f0ed0d 100644
--- a/include/kernel-5.10
+++ b/include/kernel-5.10
@@ -1,2 +1,2 @@
-LINUX_VERSION-5.10 = .132
-LINUX_KERNEL_HASH-5.10.132 = 7d05a931eee01dea64fc73849e275ff14664ff98813f95f40588f04fdf1cfa2a
+LINUX_VERSION-5.10 = .133
+LINUX_KERNEL_HASH-5.10.133 = 3b5c4c7d5bca720c11f1024c9aa00ac04397b6c7de37fd4170444077c723280e
diff --git a/target/linux/generic/hack-5.10/221-module_exports.patch b/target/linux/generic/hack-5.10/221-module_exports.patch
index 8ca464e3b2c3..11f473f09f0f 100644
--- a/target/linux/generic/hack-5.10/221-module_exports.patch
+++ b/target/linux/generic/hack-5.10/221-module_exports.patch
@@ -115,7 +115,7 @@ Signed-off-by: Felix Fietkau <nbd@nbd.name>
  	.previous
 --- a/scripts/Makefile.build
 +++ b/scripts/Makefile.build
-@@ -367,7 +367,7 @@ targets += $(lib-y) $(always-y) $(MAKECM
+@@ -373,7 +373,7 @@ targets += $(lib-y) $(always-y) $(MAKECM
  # Linker scripts preprocessor (.lds.S -> .lds)
  # ---------------------------------------------------------------------------
  quiet_cmd_cpp_lds_S = LDS     $@
diff --git a/target/linux/generic/pending-5.10/203-kallsyms_uncompressed.patch b/target/linux/generic/pending-5.10/203-kallsyms_uncompressed.patch
index 9392d7ba56e7..eee4a3865781 100644
--- a/target/linux/generic/pending-5.10/203-kallsyms_uncompressed.patch
+++ b/target/linux/generic/pending-5.10/203-kallsyms_uncompressed.patch
@@ -106,7 +106,7 @@ Signed-off-by: Felix Fietkau <nbd@nbd.name>
  		}
 --- a/scripts/link-vmlinux.sh
 +++ b/scripts/link-vmlinux.sh
-@@ -186,6 +186,10 @@ kallsyms()
+@@ -192,6 +192,10 @@ kallsyms()
  		kallsymopt="${kallsymopt} --base-relative"
  	fi
  

From 3c30db5a1ac8d073309a19f8e90b239faa3f3b4f Mon Sep 17 00:00:00 2001
From: John Audia <therealgraysky@proton.me>
Date: Mon, 25 Jul 2022 10:16:43 -0400
Subject: [PATCH 3/3] x86: update defconfig for 5.10.133

Add some new/missing symbols relating to speculative execution mitigations[1].

1. https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/Kconfig?id=v5.10.133&id2=v5.10.132

Signed-off-by: John Audia <therealgraysky@proton.me>
---
 target/linux/x86/config-5.10 | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/target/linux/x86/config-5.10 b/target/linux/x86/config-5.10
index ec27bb7945fe..13a698d05dfb 100644
--- a/target/linux/x86/config-5.10
+++ b/target/linux/x86/config-5.10
@@ -52,6 +52,9 @@ CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
 # CONFIG_CPU_FREQ_GOV_POWERSAVE is not set
 # CONFIG_CPU_FREQ_GOV_USERSPACE is not set
 CONFIG_CPU_FREQ_STAT=y
+CONFIG_CPU_IBPB_ENTRY=y
+CONFIG_CPU_IBRS_ENTRY=y
+# CONFIG_SLS is not set
 CONFIG_CPU_IDLE=y
 CONFIG_CPU_IDLE_GOV_LADDER=y
 CONFIG_CPU_SUP_AMD=y
@@ -62,11 +65,13 @@ CONFIG_CPU_SUP_INTEL=y
 CONFIG_CPU_SUP_TRANSMETA_32=y
 CONFIG_CPU_SUP_UMC_32=y
 CONFIG_CPU_SUP_ZHAOXIN=y
+CONFIG_CPU_UNRET_ENTRY=y
 CONFIG_CRASH_CORE=y
 CONFIG_CRC16=y
 CONFIG_CRYPTO_CRC32=y
 CONFIG_CRYPTO_CRC32C=y
 # CONFIG_CRYPTO_CRC32_PCLMUL is not set
+CONFIG_CRYPTO_LIB_BLAKE2S_GENERIC=y
 CONFIG_CRYPTO_LIB_POLY1305_RSIZE=1
 CONFIG_CRYPTO_RNG2=y
 # CONFIG_CRYPTO_SERPENT_SSE2_586 is not set
@@ -168,7 +173,6 @@ CONFIG_INITRAMFS_SOURCE=""
 CONFIG_INPUT=y
 CONFIG_INPUT_KEYBOARD=y
 CONFIG_INSTRUCTION_DECODER=y
-# CONFIG_INTEL_INT0002_VGPIO is not set
 # CONFIG_INTEL_PCH_THERMAL is not set
 # CONFIG_INTEL_POWERCLAMP is not set
 # CONFIG_INTEL_SCU_PCI is not set
@@ -292,6 +296,7 @@ CONFIG_PROC_PID_ARCH_STATUS=y
 CONFIG_RATIONAL=y
 CONFIG_RD_BZIP2=y
 CONFIG_RD_GZIP=y
+CONFIG_RETHUNK=y
 CONFIG_RETPOLINE=y
 CONFIG_RTC_CLASS=y
 CONFIG_RTC_MC146818_LIB=y
@@ -317,6 +322,7 @@ CONFIG_SG_POOL=y
 # CONFIG_SMSC_SCH311X_WDT is not set
 CONFIG_SPARSEMEM_STATIC=y
 CONFIG_SPARSE_IRQ=y
+CONFIG_SPECULATION_MITIGATIONS=y
 CONFIG_SRCU=y
 # CONFIG_STATIC_CALL_SELFTEST is not set
 CONFIG_SYSCTL_EXCEPTION_TRACE=y
